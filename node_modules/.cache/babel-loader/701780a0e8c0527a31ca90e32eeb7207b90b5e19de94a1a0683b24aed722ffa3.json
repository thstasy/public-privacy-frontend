{"ast":null,"code":"import _regeneratorRuntime from\"/Users/stasy/Desktop/Public+Privacy_0831/public-privacy-frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/stasy/Desktop/Public+Privacy_0831/public-privacy-frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/stasy/Desktop/Public+Privacy_0831/public-privacy-frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useState,useEffect,useContext,useRef}from\"react\";import{useNavigate,useParams}from\"react-router-dom\";import AuthContext from\"./shared/AuthContext.js\";import httpClient from\"../http-common.js\";import\"../../src/App.css\";import Footer from\"../components/Footer.js\";import Alert from\"./Alert.js\";// Update the path to your Alert.js file\nimport axios from'axios';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var AddOpinion=function AddOpinion(){var hasLoginToken=document.cookie.includes(\"loginToken\");var _useContext=useContext(AuthContext),logOut=_useContext.logOut,loginToken=_useContext.loginToken;var _useState=useState(''),_useState2=_slicedToArray(_useState,2),title=_useState2[0],setTitle=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),collaboratorName=_useState4[0],setCollaboratorName=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),body=_useState6[0],setBody=_useState6[1];var _useState7=useState(\"gender equality\"),_useState8=_slicedToArray(_useState7,2),category=_useState8[0],setCategory=_useState8[1];var _useState9=useState(\"\"),_useState10=_slicedToArray(_useState9,2),createdAt=_useState10[0],setCreatedAt=_useState10[1];var _useState11=useState(\"\"),_useState12=_slicedToArray(_useState11,2),updatedAt=_useState12[0],setUpdatedAt=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),errors=_useState14[0],setErrors=_useState14[1];var _useParams=useParams(),id=_useParams.id;var _useState15=useState(5000),_useState16=_slicedToArray(_useState15,2),remainingCharacters=_useState16[0],setRemainingCharacters=_useState16[1];var navigate=useNavigate();var _useState17=useState(false),_useState18=_slicedToArray(_useState17,2),showAlert=_useState18[0],setShowAlert=_useState18[1];var _useState19=useState(\"\"),_useState20=_slicedToArray(_useState19,2),alertMessage=_useState20[0],setAlertMessage=_useState20[1];var _useState21=useState(\"\"),_useState22=_slicedToArray(_useState21,2),alertType=_useState22[0],setAlertType=_useState22[1];var closeAlert=function closeAlert(){setShowAlert(false);};//get the geonames data\nvar _useState23=useState([]),_useState24=_slicedToArray(_useState23,2),countries=_useState24[0],setCountries=_useState24[1];var _useState25=useState('Belgium'),_useState26=_slicedToArray(_useState25,2),selectedCountry=_useState26[0],setSelectedCountry=_useState26[1];var _useState27=useState([]),_useState28=_slicedToArray(_useState27,2),cities=_useState28[0],setCities=_useState28[1];var _useState29=useState('Leuven'),_useState30=_slicedToArray(_useState29,2),selectedCity=_useState30[0],setSelectedCity=_useState30[1];var _useState31=useState(''),_useState32=_slicedToArray(_useState31,2),alreadyChosenCountry=_useState32[0],setAlreadyChosenCountry=_useState32[1];var _useState33=useState(''),_useState34=_slicedToArray(_useState33,2),alreadyChosenCity=_useState34[0],setAlreadyChosenCity=_useState34[1];console.log(\"hasLoginToken\");console.log(hasLoginToken);useEffect(function(){if(id){fetchExistingOpinion(id);}},[id]);useEffect(function(){if(body!==undefined){setRemainingCharacters(5000-body.length);}},[body]);var fetchExistingOpinion=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(opinionId){var headers,data,response,opinionData;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.prev=0;if(!hasLoginToken){_context.next=19;break;}//&&dashboardToken\nheaders={'Content-Type':'application/json'};data={loginToken:loginToken};_context.next=6;return httpClient.get(\"/forum/opinions/\".concat(opinionId),data,{withCredentials:true,headers:headers});case 6:response=_context.sent;opinionData=response.data;console.log(opinionData);setTitle(opinionData.title);setBody(opinionData.body);setCategory(opinionData.category);setCreatedAt(opinionData.createdAt);setUpdatedAt(opinionData.updatedAt);setCollaboratorName(opinionData.collaboratorName);// Add these lines to set the country and city\nsetAlreadyChosenCountry(opinionData.country);setAlreadyChosenCity(opinionData.city);_context.next=24;break;case 19:setAlertMessage(\"Apologies. You are not authorized to edit the content.\");setAlertType(\"notification\");setShowAlert(true);navigate(\"/about\");return _context.abrupt(\"return\");case 24:_context.next=30;break;case 26:_context.prev=26;_context.t0=_context[\"catch\"](0);console.error(\"Error while fetching opinion data:\",_context.t0);navigate(\"/about\");case 30:case\"end\":return _context.stop();}},_callee,null,[[0,26]]);}));return function fetchExistingOpinion(_x){return _ref.apply(this,arguments);};}();//////get geonames data\n//get the geonames data\n//these two are buttons!\nvar handleCountryChange=function handleCountryChange(event){setSelectedCountry(event.target.value);setSelectedCity('');};var handleCityChange=function handleCityChange(event){setSelectedCity(event.target.value);};useEffect(function(){axios.get('https://secure.geonames.org/countryInfoJSON?username=stasy').then(function(response){setCountries(response.data.geonames);}).catch(function(error){console.error('Error fetching countries:',error);});},[]);useEffect(function(){if(selectedCountry){var countryData=countries.find(function(country){return country.countryName===selectedCountry;});if(countryData){axios.get(\"https://secure.geonames.org/searchJSON?country=\".concat(countryData.countryCode,\"&username=stasy\")).then(function(response){setCities(response.data.geonames);}).catch(function(error){console.error('Error fetching cities:',error);});}}},[selectedCountry,countries]);var createOpinion=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(data){var headers,response;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:_context2.prev=0;if(!hasLoginToken){_context2.next=9;break;}headers={\"loginToken\":loginToken};_context2.next=5;return httpClient.post(\"/forum/opinions\",data,{withCredentials:true,headers:headers});case 5:response=_context2.sent;return _context2.abrupt(\"return\",response);case 9:setAlertMessage(\"Oops, loginToken expired. Please login again.\");setAlertType(\"notification\");setShowAlert(true);logOut();return _context2.abrupt(\"return\");case 14:_context2.next=19;break;case 16:_context2.prev=16;_context2.t0=_context2[\"catch\"](0);console.error('Error while making the POST request: Create opinion',_context2.t0);case 19:case\"end\":return _context2.stop();}},_callee2,null,[[0,16]]);}));return function createOpinion(_x2){return _ref2.apply(this,arguments);};}();var updateOpinion=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(opinion){var _id,headers,update_response;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:console.log(\"its entering updateOpiion.\");_context3.prev=1;if(!hasLoginToken){_context3.next=41;break;}_id=opinion.id;opinion.title=title;opinion.body=body;opinion.category=category;opinion.country=selectedCountry;opinion.city=selectedCity;console.log(\"After update:\",opinion);headers={\"loginToken\":loginToken};_context3.prev=11;console.log(\"To be update:\",opinion);_context3.next=15;return httpClient.put(\"/forum/opinions\",opinion,{withCredentials:true,headers:headers});case 15:update_response=_context3.sent;console.log(opinion);if(!(update_response.status===200)){_context3.next=25;break;}setAlertMessage('Opinion updated successfully!');setAlertType(\"notification\");setShowAlert(true);navigate(\"/collaborator/dashboard\");return _context3.abrupt(\"return\");case 25:setAlertMessage(\"Error updating the opinion: \".concat(update_response.data));setAlertType(\"notification\");setShowAlert(true);navigate(\"/collaborator/dashboard\");return _context3.abrupt(\"return\");case 30:_context3.next=39;break;case 32:_context3.prev=32;_context3.t0=_context3[\"catch\"](11);setAlertMessage(\"Only the initial author is able to edit the content.\");setAlertType(\"notification\");setShowAlert(true);navigate(\"/collaborator/dashboard\");return _context3.abrupt(\"return\");case 39:_context3.next=46;break;case 41:setAlertMessage(\"Having issues loading the data.\");setAlertType(\"notification\");setShowAlert(true);navigate(\"/forum/opinions\");return _context3.abrupt(\"return\");case 46:_context3.next=52;break;case 48:_context3.prev=48;_context3.t1=_context3[\"catch\"](1);console.error('Error while making the PUT request: Update opinion',_context3.t1);navigate(\"/forum/opinions\");case 52:case\"end\":return _context3.stop();}},_callee3,null,[[1,48],[11,32]]);}));return function updateOpinion(_x3){return _ref3.apply(this,arguments);};}();var saveOpinion=function saveOpinion(e){e.preventDefault();if(!title||!body){setErrors(true);return;}var opinion={title:title,body:body,category:category,id:id,collaboratorName:collaboratorName,createdAt:createdAt,updatedAt:updatedAt,country:selectedCountry,// Include selected country\ncity:selectedCity// Include selected city\n};if(id){updateOpinion(opinion).then(function(response){if(response){setAlertMessage(\"\".concat(response));setAlertType(\"notification\");setShowAlert(true);navigate(\"/forum/opinions\");return;}else{setAlertMessage(\"\".concat(response));setAlertType(\"notification\");setShowAlert(true);navigate(\"/forum/opinions\");return;}}).catch(function(error){if(error.message===403){setAlertMessage(\"\".concat(error.message));setAlertType(\"notification\");setShowAlert(true);navigate(\"/forum/opinions\");return;}else{setAlertMessage(\"Apologies. Server-side issues. We will fix it asap. \".concat(error.message));setAlertType(\"notification\");setShowAlert(true);navigate(\"/forum/opinions\");return;}});}else{createOpinion(opinion).then(function(response){if(response&&response.status===201){setAlertMessage(\"Opinion shared successfully!\");setAlertType(\"notification\");setShowAlert(true);navigate(\"/forum/opinions\");return;}}).catch(function(error){console.log(error);setAlertMessage(\"Apologies. Server-side issues. We'll fix it asap.\");setAlertType(\"notification\");setShowAlert(true);navigate(\"/forum/opinions\");return;});}};/**same for drafts */var saveDraft=function saveDraft(){var draftData={title:title,body:body,category:category,id:id,collaboratorName:collaboratorName,createdAt:createdAt,updatedAt:updatedAt,country:selectedCountry,city:selectedCity};console.log(draftData);// Navigate to the AddDraft page with draft data\nnavigate('/forum/drafts/add',{state:{draftData:draftData}});};return/*#__PURE__*/_jsxs(_Fragment,{children:[showAlert&&/*#__PURE__*/_jsx(Alert,{message:alertMessage,type:alertType,onClose:closeAlert}),/*#__PURE__*/_jsxs(\"div\",{className:\"container\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"row justify-content-left\",children:/*#__PURE__*/_jsx(\"div\",{className:\"col-sm-8\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex flex-column align-items-left\",children:[/*#__PURE__*/_jsx(\"h2\",{style:{margin:\"0em\",fontWeight:\"bolder\"},children:id?\"UPDATE AN OPINION\":\"SHARE YOUR OPINION\"}),errors&&/*#__PURE__*/_jsx(\"span\",{style:{color:'red',fontStyle:'italic'},children:\"Please enter the mandatory fields\"})]})})}),/*#__PURE__*/_jsx(\"div\",{className:\"row justify-content-left\",children:/*#__PURE__*/_jsx(\"div\",{className:\"col-sm-8\",children:/*#__PURE__*/_jsxs(\"form\",{style:{marginBottom:'0.75em'},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsxs(\"label\",{htmlFor:\"title\",children:[\"Opinion Title: \",/*#__PURE__*/_jsx(\"sup\",{children:\"*\"})]}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"form-control\",id:\"title\",value:title,onChange:function onChange(e){return setTitle(e.target.value);},required:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",style:{marginBottom:'0.75em'},children:[/*#__PURE__*/_jsxs(\"label\",{htmlFor:\"body\",children:[\"Opinion Description: \",/*#__PURE__*/_jsx(\"sup\",{children:\"*\"})]}),/*#__PURE__*/_jsx(\"textarea\",{name:\"body\",className:\"form-control\",value:body,onChange:function onChange(e){return setBody(e.target.value);},required:true,rows:20}),/*#__PURE__*/_jsxs(\"small\",{children:[remainingCharacters,\" characters remaining\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",style:{marginBottom:'0.75em'},children:[/*#__PURE__*/_jsxs(\"label\",{htmlFor:\"category\",children:[\"Opinion Category:  \",/*#__PURE__*/_jsx(\"sup\",{children:\"*\"})]}),/*#__PURE__*/_jsxs(\"select\",{id:\"category\",className:\"form-control\",value:category,onChange:function onChange(e){return setCategory(e.target.value);},required:true,children:[/*#__PURE__*/_jsx(\"option\",{value:\"gender equality\",children:\"Gender Equality\"}),/*#__PURE__*/_jsx(\"option\",{value:\"health care\",children:\"Health Care\"}),/*#__PURE__*/_jsx(\"option\",{value:\"educational system\",children:\"Educational System\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",style:{marginBottom:'0.75em'},children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"country\",children:\"Opinion inspired in:\"}),/*#__PURE__*/_jsxs(\"select\",{id:\"country\",className:\"form-control\",value:selectedCountry,onChange:handleCountryChange,children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"select a country \"}),countries.map(function(country){return/*#__PURE__*/_jsx(\"option\",{value:country.countryName,children:country.countryName},country.geonameId);})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",style:{marginBottom:'0.75em'},children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"city\",children:\" Approximately at: \"}),/*#__PURE__*/_jsxs(\"select\",{id:\"city\",className:\"form-control\",value:selectedCity,onChange:handleCityChange,children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"select a city \"}),cities.map(function(city){return/*#__PURE__*/_jsx(\"option\",{value:city.name,children:city.name},city.geonameId);})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-left\",style:{marginBottom:'0.75em'},children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:function onClick(e){return saveOpinion(e);},style:{backgroundColor:\"black\",color:\"white\",borderRadius:\"5px\",marginRight:\"10px\"// Add some spacing between buttons\n},children:id?\"Update Your Opinion\":\"Share your Opinion\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:function onClick(e){saveDraft(e);// Use the saveDraft function for drafts\n},style:{backgroundColor:'black',color:'white',borderRadius:'5px'},children:\"Save as Draft\"})]})]})})})]}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{})]}),/*#__PURE__*/_jsx(Footer,{})]});};export default AddOpinion;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}