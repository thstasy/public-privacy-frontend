{"ast":null,"code":"import _regeneratorRuntime from\"/Users/stasy/Desktop/Public+Privacy_0831/public-privacy-frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/stasy/Desktop/Public+Privacy_0831/public-privacy-frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/stasy/Desktop/Public+Privacy_0831/public-privacy-frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import jwt_decode from\"jwt-decode\";import{useNavigate}from\"react-router-dom\";import React,{createContext,useState,useEffect}from\"react\";import httpClient from\"../../http-common.js\";import Alert from\"../../components/Alert.js\";// Update the path to your Alert.js file\nimport{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var AuthContext=/*#__PURE__*/createContext();export var AuthContextProvider=function AuthContextProvider(_ref){var children=_ref.children;var hasLoginToken=document.cookie.includes(\"loginToken\");var _useState=useState(hasLoginToken),_useState2=_slicedToArray(_useState,2),isAuthenticated=_useState2[0],setAuthentication=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),username=_useState4[0],setUsername=_useState4[1];var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),email=_useState6[0],setEmail=_useState6[1];var _useState7=useState(null),_useState8=_slicedToArray(_useState7,2),loginToken=_useState8[0],setLoginToken=_useState8[1];var _useState9=useState(),_useState10=_slicedToArray(_useState9,2),basicUserInfo=_useState10[0],setBasicUserInfo=_useState10[1];var _useState11=useState([]),_useState12=_slicedToArray(_useState11,2),opinionsByUser=_useState12[0],setOpinionsByUser=_useState12[1];var _useState13=useState([]),_useState14=_slicedToArray(_useState13,2),draftsByUser=_useState14[0],setDraftsByUser=_useState14[1];var navigate=useNavigate();var _useState15=useState(false),_useState16=_slicedToArray(_useState15,2),showAlert=_useState16[0],setShowAlert=_useState16[1];var _useState17=useState(\"\"),_useState18=_slicedToArray(_useState17,2),alertMessage=_useState18[0],setAlertMessage=_useState18[1];var _useState19=useState(\"notification\"),_useState20=_slicedToArray(_useState19,2),alertType=_useState20[0],setAlertType=_useState20[1];var _useState21=useState({}),_useState22=_slicedToArray(_useState21,2),alertCallbacks=_useState22[0],setAlertCallbacks=_useState22[1];var handleShowAlert=function handleShowAlert(message){var type=arguments.length>1&&arguments[1]!==undefined?arguments[1]:\"notification\";var callbacks=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};setAlertMessage(message);setAlertType(type);setAlertCallbacks(callbacks);setShowAlert(true);};// const [showDecisionAlert, setShowDecisionAlert] = useState(false);\n// const [decisionAlertMessage, setDecisionAlertMessage] = useState(\"\");\n// const [decisionAlertCallbacks, setDecisionAlertCallbacks] = useState({});\n// const handleShowDecisionAlert = (message, callbacks = {}) => {\n//   setDecisionAlertMessage(message);\n//   setDecisionAlertCallbacks(callbacks);\n//   setShowDecisionAlert(true);\n// };\n// const handleHideDecisionAlert = () => {\n//   setShowDecisionAlert(false);\n//   setDecisionAlertMessage(\"\");\n//   setDecisionAlertCallbacks({});\n// };\nvar handleHideAlert=function handleHideAlert(){setShowAlert(false);setAlertMessage(\"\");setAlertType(\"notification\");setAlertCallbacks({});};var updateAuthenticationStatus=function updateAuthenticationStatus(isAuthenticated){setAuthentication(isAuthenticated);};var AccessDashboard=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var headers,apiResponse,responseBody,_opinionsByUser,_draftsByUser;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:console.log(\"hey I am in AccessDashboard in AuthContext.\");_context.prev=1;headers={\"loginToken\":loginToken};_context.next=5;return httpClient.get(\"/collaborator/dashboard\",{withCredentials:true,headers:headers});case 5:apiResponse=_context.sent;responseBody=apiResponse.data;_opinionsByUser=responseBody.opinionsByUser;_draftsByUser=responseBody.draftsByUser;console.log(_opinionsByUser);console.log(_draftsByUser);setOpinionsByUser(responseBody.opinionsByUser);setDraftsByUser(responseBody.draftsByUser);_context.next=19;break;case 15:_context.prev=15;_context.t0=_context[\"catch\"](1);console.error(\"\".concat(_context.t0)+'in Auth context 62.');handleShowAlert(\"An error occurred while accessing the dashboard.\",\"notification\");case 19:case\"end\":return _context.stop();}},_callee,null,[[1,15]]);}));return function AccessDashboard(){return _ref2.apply(this,arguments);};}();var LogIn=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(payload){var apiResponse,_loginToken,decodedToken,_username,_email,expirationTime,cookieOptions;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:if(!document.cookie.includes(\"loginToken\")){_context2.next=5;break;}handleShowAlert(\"You are already logged in.\");return _context2.abrupt(\"return\");case 5:_context2.prev=5;_context2.next=8;return httpClient.post(\"/collaborator/login\",payload,{withCredentials:true});case 8:apiResponse=_context2.sent;if(apiResponse.status!==200){handleShowAlert(\"Oops, the input is incorrect. Please try again.\",\"notification\");document.cookie=\"loginToken=; expires=Thu, 01 Jan 1970 00:00:00 UTC;\";navigate(\"/about\");}else{_loginToken=apiResponse.data;setLoginToken(_loginToken);// Decode the token to retrieve claims\ndecodedToken=jwt_decode(_loginToken);_username=decodedToken.username;console.log(_username);_email=decodedToken.sub;// sub represents the subject claim\nconsole.log(_email);setUsername(_username);setEmail(_email);setTimeout(function(){handleShowAlert(\"Login Successfully!\",\"notification\");},500);expirationTime=new Date();expirationTime.setTime(expirationTime.getTime()+7*24*60*60*1000);// 1week from now\ncookieOptions=\"Expires=\".concat(expirationTime.toUTCString());document.cookie=\"loginToken=\".concat(_loginToken,\";\").concat(cookieOptions);setAuthentication(true);navigate('/collaborator/dashboard');}_context2.next=16;break;case 12:_context2.prev=12;_context2.t0=_context2[\"catch\"](5);handleShowAlert(\"The input is incorrect. Please try again.\",\"notification\");console.error(\"Error logging in at AuthContext:\",_context2.t0);case 16:case\"end\":return _context2.stop();}},_callee2,null,[[5,12]]);}));return function LogIn(_x){return _ref3.apply(this,arguments);};}();var LogOut=function LogOut(){document.cookie=\"loginToken=; expires=Thu, 01 Jan 1970 00:00:00 UTC;\";setAuthentication(false);setBasicUserInfo(null);handleShowAlert(\"Logged Out. Login Token Devalidated.\",\"notification\");setTimeout(function(){navigate(\"/about\");},1000);};// const LogOut = async (handleShowAlert, handleShowDecisionAlert) => {\n//   handleShowDecisionAlert(\n//     \"Do you want to save drafts or post something before the token expires?\",\n//     {\n//       onConfirm: () => {\n//         const extendToken = () => {\n//           const tokenExpiryDate = new Date();\n//           tokenExpiryDate.setTime(tokenExpiryDate.getTime() + 10 * 60 * 1000); // Extend by 10 minutes\n//           document.cookie = `loginToken=${loginToken}; expires=${tokenExpiryDate.toUTCString()};`;\n//           handleShowAlert(\"Token expires in 10 minutes, so you can save drafts :)\", \"notification\");\n//         };\n//         extendToken();\n//       },\n//       onCancel: () => {\n//         document.cookie = \"loginToken=; expires=Thu, 01 Jan 1970 00:00:00 UTC;\";\n//         setAuthentication(false);\n//         setBasicUserInfo(null);\n//         handleShowAlert(\"Logged Out. Login Token Devalidated.\", \"notification\");\n//         setTimeout(() => {\n//           navigate(\"/about\");\n//         }, 1000);\n//       },\n//     }\n//   );\n// };\nvar handleNavbarReload=function handleNavbarReload(){var navbarLinks=document.querySelectorAll(\".navbar-link\");navbarLinks.forEach(function(link){link.addEventListener(\"click\",function(){window.location.reload();});});};useEffect(function(){handleNavbarReload();},[hasLoginToken]);return/*#__PURE__*/_jsxs(\"div\",{children:[showAlert&&/*#__PURE__*/_jsx(Alert,{type:alertType,message:alertMessage,onClose:handleHideAlert,onConfirm:alertCallbacks.onConfirm,onCancel:alertCallbacks.onCancel}),/*#__PURE__*/_jsx(AuthContext.Provider,{value:{LogIn:LogIn,AccessDashboard:AccessDashboard,opinionsByUser:opinionsByUser,draftsByUser:draftsByUser,isAuthenticated:isAuthenticated,basicUserInfo:basicUserInfo,username:username,email:email,LogOut:LogOut,setAuthentication:setAuthentication,setBasicUserInfo:setBasicUserInfo,loginToken:loginToken,handleShowAlert:handleShowAlert,updateAuthenticationStatus:updateAuthenticationStatus},children:children})]});};export default AuthContext;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}