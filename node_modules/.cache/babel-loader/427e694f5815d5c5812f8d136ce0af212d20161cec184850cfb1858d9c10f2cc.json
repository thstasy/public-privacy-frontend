{"ast":null,"code":"import _regeneratorRuntime from\"/Users/stasy/Desktop/Public+Privacy_0831/public-privacy-frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/stasy/Desktop/Public+Privacy_0831/public-privacy-frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/stasy/Desktop/Public+Privacy_0831/public-privacy-frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useState,useEffect,useContext}from\"react\";import{useNavigate,useParams}from\"react-router-dom\";import httpClient from\"../http-common.js\";import Footer from\"./Footer.js\";import AuthContext from\"./shared/AuthContext.js\";import\"../Alert.css\";import Alert from\"./Alert.js\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var DraftDetails=function DraftDetails(){var _useContext=useContext(AuthContext),loginToken=_useContext.loginToken,username=_useContext.username;var _useParams=useParams(),id=_useParams.id;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),currentDraft=_useState2[0],setCurrentDraft=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),alert=_useState4[0],setAlert=_useState4[1];// Added alert state\nvar navigate=useNavigate();// Read\nvar getDraft=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(id){var headers,response;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:headers={\"loginToken\":loginToken};_context.prev=1;_context.next=4;return httpClient.get(\"/forum/drafts/\".concat(id),{withCredentials:true,headers:headers});case 4:response=_context.sent;return _context.abrupt(\"return\",response);case 8:_context.prev=8;_context.t0=_context[\"catch\"](1);console.log(_context.t0);case 11:case\"end\":return _context.stop();}},_callee,null,[[1,8]]);}));return function getDraft(_x){return _ref.apply(this,arguments);};}();// Delete\nvar removeDraft=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(id){return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:setAlert({type:\"decision\",message:\"Are you sure you want to delete this draft?\",onConfirm:function(){var _onConfirm=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var headers,response;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:headers={\"loginToken\":loginToken};_context2.prev=1;_context2.next=4;return httpClient.delete(\"/forum/drafts/\".concat(id),{withCredentials:true,headers:headers});case 4:response=_context2.sent;if(response.status===204){setAlert({type:\"notification\",message:\"Deleted!\",onClose:function onClose(){return navigate(\"/collaborator/dashboard\");}});}return _context2.abrupt(\"return\",response);case 9:_context2.prev=9;_context2.t0=_context2[\"catch\"](1);console.log(_context2.t0);setAlert({type:\"notification\",message:\"Either 1. Only the initial author can modify the content, 2. An unknown loading bug. Come back later!\",onClose:function onClose(){return navigate(\"/collaborator/dashboard\");}});case 13:case\"end\":return _context2.stop();}},_callee2,null,[[1,9]]);}));function onConfirm(){return _onConfirm.apply(this,arguments);}return onConfirm;}(),onCancel:function onCancel(){}});case 1:case\"end\":return _context3.stop();}},_callee3);}));return function removeDraft(_x2){return _ref2.apply(this,arguments);};}();//post   \nvar postDraftAsOpinion=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4(id){var draftResponse,draftData,opinionData,opinionResponse;return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1)switch(_context4.prev=_context4.next){case 0:_context4.prev=0;_context4.next=3;return httpClient.get(\"/forum/drafts/\".concat(id),{withCredentials:true,headers:{\"loginToken\":loginToken}});case 3:draftResponse=_context4.sent;if(!(draftResponse.status===200)){_context4.next=11;break;}draftData=draftResponse.data;opinionData={id:draftData.id,updatedAt:new Date(draftData.updatedAt).toUTCString(),createdAt:new Date(draftData.createdAt).toUTCString(),collaborator_name:draftData.collaboratorName,category:draftData.category,body:draftData.body,title:draftData.title,country:draftData.country,city:draftData.city};_context4.next=9;return httpClient.post(\"/forum/opinions\",opinionData,{withCredentials:true,headers:{\"loginToken\":loginToken}});case 9:opinionResponse=_context4.sent;if(opinionResponse.status===201){setAlert({type:\"notification\",message:\"Posted Successfully as Opinion!\",onClose:function onClose(){return navigate(\"/collaborator/dashboard\");}});}case 11:_context4.next=17;break;case 13:_context4.prev=13;_context4.t0=_context4[\"catch\"](0);console.log(_context4.t0);setAlert({type:\"notification\",message:\"Either 1. Only the initial author can modify the content, 2. An unknown loading bug. Come back later!\",onClose:function onClose(){return navigate(\"/forum/opinions\");}});case 17:case\"end\":return _context4.stop();}},_callee4,null,[[0,13]]);}));return function postDraftAsOpinion(_x3){return _ref3.apply(this,arguments);};}();//Post As Opinion\nvar handlePost=function handlePost(){postDraftAsOpinion(id);};var handleDelete=function handleDelete(){removeDraft(id);};var handleEdit=function handleEdit(){navigate(\"/forum/drafts/edit/\".concat(id));};var stayOnPage=function stayOnPage(){navigate(\"/forum/drafts/\".concat(id));};useEffect(function(){stayOnPage();},[]);useEffect(function(){getDraft(id).then(function(response){var message=response.status;var draftData=response.data;var updatedAt=new Date(draftData.updatedAt).toUTCString();var createdAt=new Date(draftData.createdAt).toUTCString();setCurrentDraft({id:draftData.id,updatedAt:updatedAt,createdAt:createdAt,collaborator_name:username,category:draftData.category,body:draftData.body,title:draftData.title,country:draftData.country,city:draftData.city});if(message===204){setAlert({type:\"notification\",message:\"Apologies. This draft is deleted.\",onClose:function onClose(){return navigate(\"/collaborator/dashboard\");}});return;}else if(message===403){setAlert({type:\"notification\",message:\"Sorry, you are not authorized to see the content.\",onClose:function onClose(){return navigate(\"/about\");}});return;}else if(message===500){setAlert({type:\"notification\",message:\"Server-side issues. We'll try to fix it asap.\",onClose:function onClose(){return navigate(\"/about\");}});return;}}).catch(function(error){console.log(error);navigate(\"/about\");});},[id]);return/*#__PURE__*/_jsxs(_Fragment,{children:[alert&&/*#__PURE__*/_jsx(Alert,{type:alert.type,message:alert.message,onClose:alert.onClose,onConfirm:alert.onConfirm,onCancel:alert.onCancel}),/*#__PURE__*/_jsx(\"div\",{className:\"container\",children:/*#__PURE__*/_jsx(\"div\",{className:\"row justify-content-left\",children:/*#__PURE__*/_jsx(\"div\",{className:\"col-md-8\",children:currentDraft&&/*#__PURE__*/_jsx(\"div\",{style:{width:\"100%\",paddingLeft:\"0\"},children:/*#__PURE__*/_jsxs(\"div\",{style:{border:\"10px solid black\",padding:\"1em\",margin:\"1em 0\"},children:[/*#__PURE__*/_jsxs(\"article\",{children:[/*#__PURE__*/_jsx(\"h5\",{className:\"text-capitalize \",style:{wordBreak:\"break-word\"},children:currentDraft.title}),/*#__PURE__*/_jsx(\"div\",{className:\"my-3\",style:{marginBottom:\"0.5em\",fontWeight:\"bolder\"},children:/*#__PURE__*/_jsx(\"span\",{className:\"text-capitalize\",style:{wordBreak:\"break-word\"},children:currentDraft.category})}),/*#__PURE__*/_jsx(\"div\",{className:\"my-3\",style:{marginBottom:\"0.5em\",wordBreak:\"break-word\"},children:currentDraft.body}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),currentDraft.country||currentDraft.city?/*#__PURE__*/_jsxs(\"div\",{className:\"my-3\",style:{marginBottom:\"0.5em\",wordBreak:\"break-word\",textAlign:\"right\",fontSize:\"smaller\"},children:[\"inspired at \",/*#__PURE__*/_jsxs(\"span\",{style:{fontWeight:\"bolder\"},children:[currentDraft.country,\", \",currentDraft.city]})]}):null,/*#__PURE__*/_jsx(\"div\",{className:\"my-3\",style:{marginBottom:\"0.5em\"},children:/*#__PURE__*/_jsxs(\"h6\",{style:{fontWeight:\"lighter\",fontSize:\"smaller\",textAlign:\"right\"},children:[\"Last Updated: \",new Date(currentDraft.updatedAt).toLocaleDateString()]})})]}),/*#__PURE__*/_jsx(\"button\",{onClick:handlePost,style:{backgroundColor:\"black\",color:\"white\",borderRadius:\"3px\"},children:\"Post As Opinion\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleEdit,className:\"ms-3\",style:{backgroundColor:\"black\",color:\"white\",borderRadius:\"3px\"},children:\"Edit\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleDelete,className:\"ms-3\",style:{backgroundColor:\"black\",color:\"white\",borderRadius:\"3px\"},children:\"Delete\"})]})})})})}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(Footer,{})]});};export default DraftDetails;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}